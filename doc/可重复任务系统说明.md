# 🔁 可重复任务系统说明

## 🎯 系统设计

任务系统支持两种类型的任务：

### 1. 🎯 一次性任务
- 完成一次后就标记为已完成
- 不能重复完成
- 适合：特定目标、项目、一次性事件

### 2. 🔁 可重复任务
- 可以多次完成
- 支持单日完成次数上限
- 支持总完成次数上限
- 适合：日常习惯、周期性活动

---

## 📊 可重复任务配置

### 单日完成次数上限
- **用途：** 限制每天最多完成几次
- **示例：** 阅读任务，每天最多3次
- **设置：** 0 = 无限制

### 总完成次数上限
- **用途：** 任务总共完成多少次后自动标记为已完成
- **示例：** "跑步100次"，完成100次后任务完成
- **设置：** 0 = 无限制

---

## 💡 任务示例

### 示例1：每日阅读（有单日限制）

```
任务标题：阅读30分钟
任务类型：🔁 可重复
单日完成上限：3次
总完成次数上限：0（无限制）
奖励：
  - 智力 +1
  - 金币 +10

效果：
  - 每天最多完成3次
  - 总次数无限制
  - 第二天重置，又可以完成3次
```

---

### 示例2：跑步挑战（有总次数限制）

```
任务标题：跑步5公里
任务类型：🔁 可重复
单日完成上限：0（无限制）
总完成次数上限：100次
奖励：
  - 力量 +1
  - 体力 +1
  - 金币 +15

效果：
  - 每天可以完成任意次数
  - 总共完成100次后，任务自动完成
  - 完成后会移到"已完成"列表
```

---

### 示例3：每日打卡（单日和总次数都限制）

```
任务标题：早起打卡
任务类型：🔁 可重复
单日完成上限：1次
总完成次数上限：365次
奖励：
  - 精神 +1
  - 金币 +5

效果：
  - 每天只能完成1次
  - 总共完成365次（一年）后完成
  - 适合年度挑战
```

---

### 示例4：自由学习（无任何限制）

```
任务标题：学习编程
任务类型：🔁 可重复
单日完成上限：0（无限制）
总完成次数上限：0（无限制）
奖励：
  - 智力 +2
  - 金币 +20

效果：
  - 随时可以完成
  - 没有次数限制
  - 适合长期培养的习惯
```

---

## 🎮 任务状态显示

### 进行中的任务

```
📚 阅读30分钟 [🔁 可重复]
  💰 +10金币  🧠 +1智力

  今日: 2/3      ← 今天已完成2次，还可以完成1次
  总计: 45次      ← 总共完成了45次

  [✅ 完成] [🗑️]
```

### 达到单日上限

```
📚 阅读30分钟 [🔁 可重复]
  今日: 3/3      ← 已达今日上限
  总计: 48次

  [今日已达上限(3次)] [🗑️]  ← 按钮禁用
```

### 达到总次数上限

```
🏃 跑步5公里 [🔁 可重复]
  今日: 1次
  总计: 100/100  ← 已完成所有次数

  移到"已完成"列表 →
```

---

## 🔄 每日重置机制

### 自动重置
- 每天0点，所有可重复任务的"今日完成次数"自动重置为0
- 第二天又可以继续完成

### 示例流程

**第1天：**
```
阅读任务
  今日: 0/3
  完成 → 今日: 1/3
  完成 → 今日: 2/3
  完成 → 今日: 3/3 (达到上限)
```

**第2天（自动重置）：**
```
阅读任务
  今日: 0/3    ← 自动重置
  总计: 3次    ← 总次数累加

  又可以完成3次！
```

---

## 📜 历史记录显示

### 可重复任务的记录

```
✅ 14:30 完成"阅读30分钟" (第3次)
   💰 +10金币  🧠 +1智力

✅ 10:15 完成"阅读30分钟" (第2次)
   💰 +10金币  🧠 +1智力

✅ 08:00 完成"阅读30分钟" (第1次)
   💰 +10金币  🧠 +1智力
```

显示第几次完成，方便追踪进度！

---

## 🎯 使用建议

### 1. 培养日常习惯
使用"可重复任务 + 单日上限"
```
- 阅读（每天最多3次）
- 运动（每天最多2次）
- 学习（每天最多4次）
```

### 2. 长期挑战目标
使用"可重复任务 + 总次数上限"
```
- 跑步100次
- 阅读50本书
- 写作365天
```

### 3. 无限重复习惯
使用"可重复任务 + 无限制"
```
- 喝水
- 深呼吸
- 冥想
```

### 4. 特定事件
使用"一次性任务"
```
- 完成项目报告
- 参加面试
- 买生日礼物
```

---

## 🚀 实现细节

### 判断逻辑

```typescript
// 检查是否可以完成任务
function canComplete(task) {
  if (task.type === 'once') {
    // 一次性任务：未完成则可以完成
    return !task.completed;
  }

  // 可重复任务

  // 检查单日限制
  if (task.dailyLimit && task.todayCount >= task.dailyLimit) {
    return false; // 今日已达上限
  }

  // 检查总次数限制
  if (task.totalLimit && task.completionCount >= task.totalLimit) {
    return false; // 总次数已达上限
  }

  return true; // 可以完成
}
```

### 完成任务流程

```typescript
function completeTask(taskId) {
  const task = findTask(taskId);

  if (task.type === 'once') {
    // 一次性任务：标记为完成
    task.completed = true;
    task.completedAt = now;
  } else {
    // 可重复任务：增加计数
    task.completionCount += 1;
    task.todayCompletionCount += 1;
    task.lastCompletedDate = today;

    // 如果达到总次数上限，标记为完成
    if (task.totalLimit && task.completionCount >= task.totalLimit) {
      task.completed = true;
    }
  }

  // 发放奖励
  giveRewards(task.rewards);

  // 记录历史
  saveLog(task, task.completionCount);
}
```

---

## 📊 统计数据

顶部统计卡片显示：
- 💰 当前金币
- 📋 进行中的任务数
- ✅ 已完成的任务数
- 🔁 可重复任务数

---

## 🎁 与奖励系统的配合

可重复任务让你可以：
- **稳定收入** - 每天通过重复任务赚金币
- **快速成长** - 多次完成累积经验值
- **属性提升** - 重复练习提升特定属性

**示例：**
```
阅读任务（每天3次）
  奖励：智力+1，金币+10

一个月下来：
  完成次数：3次/天 × 30天 = 90次
  总智力：+90
  总金币：+900
```

---

## 💡 最佳实践

1. **合理设置单日上限**
   - 不要设置过高（避免过度疲劳）
   - 不要设置过低（保持动力）
   - 建议：2-5次

2. **使用总次数上限制定长期目标**
   - 100天打卡挑战
   - 365天习惯养成
   - 50本书阅读计划

3. **区分任务类型**
   - 日常习惯 → 可重复 + 单日限制
   - 长期目标 → 可重复 + 总次数限制
   - 特定事件 → 一次性任务

4. **避免无限制重复**
   - 除非真的需要无限制
   - 否则建议设置单日上限

---

## 🎉 总结

可重复任务系统让你的人生RPG更加灵活：

- **🎯 一次性** = 特定目标
- **🔁 可重复 + 单日限制** = 日常习惯
- **🔁 可重复 + 总次数限制** = 长期挑战
- **🔁 可重复 + 无限制** = 自由练习

**开始创建你的第一个可重复任务吧！** 🚀
