# 🏆 挑战任务系统说明

## 🎯 什么是挑战任务？

挑战任务是一种**有时间限制**的特殊任务，必须在截止时间前完成：
- ✅ **按时完成** → 获得丰厚奖励
- ❌ **超时未完成** → 受到惩罚（扣金币/属性）

这让任务系统充满**紧迫感**和**挑战性**！

---

## 📊 三种任务类型对比

| 特性 | 🎯 一次性 | 🔁 可重复 | 🏆 挑战 |
|------|----------|----------|--------|
| **完成次数** | 1次 | 多次 | 1次 |
| **时间限制** | ❌ 无 | ❌ 无 | ✅ 有截止时间 |
| **失败惩罚** | ❌ 无 | ❌ 无 | ✅ 超时扣除资源 |
| **适用场景** | 特定目标 | 日常习惯 | 紧急挑战 |

---

## 🏆 挑战任务特点

### 1. ⏰ 截止时间倒计时

实时显示剩余时间：
```
剩余: 2天 5小时     → 绿色（充裕）
剩余: 5小时 30分钟  → 黄色（紧张）
剩余: 45分钟        → 红色（紧急）
已过期              → 自动失败
```

### 2. 💰 成功奖励

按时完成获得奖励，奖励通常比普通任务更丰厚：
```
经验值 +50
金币 +100
智力 +3
```

### 3. ⚠️ 失败惩罚

超时未完成会扣除资源：
```
金币 -20
智力 -1
```

### 4. 🔔 自动检测

系统每分钟自动检查是否有任务过期，过期立即标记为失败并应用惩罚。

---

## 💡 任务示例

### 示例1：3天读书挑战

```
任务标题：3天内读完《XXX》
任务分类：🧠 学习
截止时间：2026-01-23 23:59

成功奖励：
  - 智力 +3
  - 金币 +50
  - 经验值 +100

失败惩罚：
  - 金币 -20
  - 智力 -1

效果：
  - 必须在3天内完成
  - 完成 → 获得丰厚奖励
  - 超时 → 扣除金币和智力
```

---

### 示例2：24小时健身挑战

```
任务标题：24小时内完成5公里跑
任务分类：💪 运动
截止时间：明天 18:00

成功奖励：
  - 力量 +2
  - 体力 +2
  - 金币 +30

失败惩罚：
  - 金币 -15

效果：
  - 今天必须完成
  - 完成 → 力量和体力大幅提升
  - 超时 → 扣金币
```

---

### 示例3：周末完成项目

```
任务标题：周末完成项目报告
任务分类：💼 工作
截止时间：周日 20:00

成功奖励：
  - 智力 +5
  - 金币 +200
  - 经验值 +150

失败惩罚：
  - 金币 -50
  - 智力 -2
  - 精神 -1

效果：
  - 必须在周末完成
  - 奖励巨大，但惩罚也严厉
  - 适合重要的deadline
```

---

## 🎮 使用流程

### 1. 创建挑战任务

```
1. 点击"创建任务"
2. 选择"🏆 挑战"类型
3. 设置截止时间（必填）
4. 配置成功奖励
5. 配置失败惩罚
6. 点击"创建任务"
```

### 2. 查看倒计时

```
任务卡片上实时显示：
  ⏰ 剩余: 1天 3小时
```

颜色提示：
- **绿色** - 时间充裕（>1天）
- **黄色** - 时间紧张（3小时-1天）
- **橙色** - 时间紧急（<3小时）
- **红色** - 最后倒计时（<1小时）

### 3. 完成任务

```
- 点击"✅ 完成"按钮
- 立即获得成功奖励
- 任务移到"已完成"列表
```

### 4. 任务过期

```
- 系统自动检测过期
- 自动标记为"失败"
- 扣除惩罚资源
- 任务移到"已失败"列表
```

---

## 📜 历史记录显示

### 成功的挑战

```
🏆 15:30 完成"3天内读完XXX" [挑战成功]
   💰 +50金币  🧠 +3智力  ⭐ +100经验值
```

橙色高亮显示，标注"挑战成功"

### 失败的挑战

```
❌ 23:59 "24小时健身挑战" [挑战失败]
   💰 -15金币
```

红色背景显示，标注"挑战失败"和惩罚

---

## ⚙️ 系统机制

### 自动过期检测

```typescript
// 每分钟检查一次
setInterval(() => {
  checkExpiredChallenges();
}, 60000);

// 检查所有挑战任务
function checkExpiredChallenges() {
  const now = new Date();

  tasks.forEach(task => {
    if (
      task.type === 'challenge' &&
      task.status === 'active' &&
      new Date(task.deadline) < now
    ) {
      failTask(task.id); // 标记失败，应用惩罚
    }
  });
}
```

### 完成时的检查

```typescript
function completeTask(taskId) {
  const task = getTask(taskId);

  if (task.type === 'challenge') {
    // 检查是否过期
    if (new Date(task.deadline) < new Date()) {
      alert('任务已过期！');
      failTask(taskId);
      return;
    }
  }

  // 按时完成，发放奖励
  giveRewards(task.rewards);
  task.status = 'completed';
}
```

### 失败惩罚

```typescript
function failTask(taskId) {
  const task = getTask(taskId);

  // 应用惩罚
  task.penalties.forEach(penalty => {
    switch (penalty.type) {
      case 'gold':
        character.gold -= penalty.amount;
        character.gold = Math.max(0, character.gold); // 不低于0
        break;
      case 'strength':
        character.strength -= penalty.amount;
        character.strength = Math.max(5, character.strength); // 最低5
        break;
      // ... 其他属性
    }
  });

  // 记录失败日志
  saveLog({
    taskTitle: task.title,
    penalties: task.penalties,
    isChallenge: true,
  });

  task.status = 'failed';
}
```

---

## 🎯 使用建议

### 1. 合理设置截止时间

- **短期挑战**（几小时）- 高风险高回报
- **中期挑战**（1-3天）- 平衡风险和收益
- **长期挑战**（1周）- 重要目标

### 2. 平衡奖励和惩罚

**推荐比例：**
```
成功奖励：失败惩罚 = 2:1 到 3:1

例如：
成功：金币+60
失败：金币-20
```

### 3. 不要设置过多挑战

建议同时进行的挑战任务：**1-3个**
- 太多会造成压力
- 容易顾此失彼

### 4. 优先级管理

- 🔴 **高优先级** - 截止时间近的挑战
- 🟡 **中优先级** - 还有1-2天的挑战
- 🟢 **低优先级** - 时间充裕的挑战

### 5. 避免过度惩罚

不要设置会导致属性降到最低值的惩罚：
```
❌ 不好：失败扣除-20智力（可能降到5）
✅ 好：失败扣除-2智力（保留实力）
```

---

## 📊 统计数据

顶部统计卡片新增：
```
🏆 挑战中: 3    ← 正在进行的挑战任务数
❌ 已失败: 2    ← 失败的挑战数
```

历史记录中：
- 挑战成功会特别标注
- 挑战失败会单独统计

---

## 🚀 实战技巧

### 技巧1：设置缓冲时间

```
实际需要：2天
设置截止：3天

→ 留出1天缓冲，降低失败风险
```

### 技巧2：分阶段挑战

```
大目标：7天读完一本书
拆分成：
  - 挑战1：3天读完前半部分
  - 挑战2：4天读完后半部分

→ 降低单次失败损失
```

### 技巧3：先小后大

```
新手：
  - 先创建短期、低惩罚的挑战
  - 熟悉机制后再尝试高风险挑战

老手：
  - 可以设置高风险高回报的挑战
  - 追求极限成长
```

---

## ⚠️ 注意事项

1. **截止时间不能修改**
   - 一旦创建，截止时间固定
   - 慎重设置

2. **过期自动失败**
   - 系统自动检测
   - 不会有提醒，注意查看倒计时

3. **惩罚立即生效**
   - 失败后立即扣除资源
   - 无法撤销

4. **不能重复完成**
   - 挑战任务是一次性的
   - 完成或失败后就结束

---

## 🎉 总结

挑战任务为人生RPG增加了：
- ⏰ **时间压力** - 倒计时带来紧迫感
- 🎁 **高额奖励** - 成功后获得更多资源
- ⚠️ **失败惩罚** - 失败有代价，增加真实感
- 📊 **成就感** - 战胜挑战获得满足感

**合理使用挑战任务，让你的成长更有动力！** 🚀

---

## 🆚 与普通任务的选择

**何时使用挑战任务？**
- ✅ 有明确deadline的事项
- ✅ 需要紧迫感驱动的目标
- ✅ 重要但容易拖延的任务

**何时使用普通任务？**
- ✅ 长期培养的习惯
- ✅ 没有固定期限的目标
- ✅ 不需要压力的日常活动

**开始你的第一个挑战吧！** 🏆✨
